<div class="card" ng-controller="RfqsController">
    <h1>Sample Submission</h1>
    <section ng-init="findOneByRfqId()">

        <div ng-include="'views/rfqs/rfqBasicDetail.html'"></div>

        <div class="row">
            <div class="col col-lg-3 " style="border-right:1px solid #000;">
                <h3><strong>Action</strong></h3>
                <div ng-include="'views/rfqs/rfqLeftNavigation.htm'"></div>
            </div>

            <div class="col col-lg-9">
                <h3>Sample Submission</h3>

                <!--Sample Status data start-->
                <div data-ng-init="getAllSampleStatus()" ng-show="sampleStatusData.length">
                    <table class="table table-bordered col col-lg-9">
                        <thead>
                            <tr>
                                <th style="text-align:center">Process</th>
                                <th style="text-align:center">Target date</th>
                                <th style="text-align:center">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="data in sampleStatusData">
                                <td style="text-align:center">
                                    <label style="color:dodgerblue;">{{data.status}}</label>
                                </td>
                                <td style="text-align:center">
                                    <label>{{data.targetDate  | date:'medium'}}</label>
                                </td>
                                <td style="text-align:center">
                                        Working
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!--Sample Status data end-->

                <div data-ng-controller="SampleSubmissionsController" data-ng-init="findOne()">
                    <div class="row">
                        <ul class="elastislide1">
                            <li class="img_wrp" data-ng-repeat="image in samplesubmission.Samplesubmissionimages | orderBy : '-createdAt'" style="margin-right:3px;">
                                <a data-fancybox="gallery" href="{{image.imagePath}}">
                                    <img src="{{image.imagePath}}" alt="image{{image.id}}" />
                                </a>
                                <a ng-click="deleteImage(image.id)"><i class="close fa fa-close" aria-hidden="true" /></a>
                            </li>
                        </ul>
                    </div>
                </div>
                <br /><br />

                      <div ng-hide="isPoReceived(rfq)">
                          <div id="myId" class="dropzone"></div>

                          <br />

                          <div ng-controller="SampleSubmissionsController">
                              <input type="hidden" ng-init="findOne()" class="form-control hdnSamplesubmissionStatus" value="{{samplesubmission.status}}">                             
                          </div>

                          <div class="control-group">
                              <label for="status" class="control-label">Status</label>
                              <div class="controls row">
                                  <div class="col-lg-6">
                                      <select class="form-control ddlSamplesubmission" id="selectedStatus" ng-init="findOne()" data-ng-model="samplesubmission.status" required>
                                          <option value="">Select Status</option>
                                          <option ng-repeat="status in Status" value="{{status}}">{{status}}</option>
                                      </select>                                      
                                  </div>
                                  <div class="col-lg-6">
                                      <div class="errorStatus error"></div>
                                  </div>
                              </div>
                          </div>
                          <br />
                                <div class="control-group">
                                    <label class="control-label">Target Date</label>
                                    <div class="controls row">
                                        <div class="col-lg-6">
                                            <div class="input-group date" data-provide="datepicker">
                                                <input type="text" class="datepicker form-control" id="sampleStatusTargetDate" name="sampleStatusTargetDate" placeholder="Select Target Date" value="{{targetdate | date:'MM/dd/yyyy'}}">
                                                <div class="input-group-addon">
                                                    &nbsp;<span class="fa f-s-30 fa-calendar"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="errorDate error"></div>
                                        </div>
                                    </div>
                                </div>

                          <input type="text" style="display:none;" class="hdnImages" name="imagesString" id="imagesString" data-ng-model="imagesString" />
                          <div class="clear clearfix"></div><br />
                          <div class="control-group">
                              <div class="controls">
                                  <input type="submit" class="btn btn-primary btn-Save" value="Save">
                                  <a class="btn btn-secondary" href="javascript:window.history.back();">Cancel</a>
                              </div>
                          </div>
                      </div>
                <input type="hidden" class="hdnRfqId" value="{{rfq.id}}" />
                <br />
            </div>
                </div>

</section>
    </div>
    <!--<script type="text/javascript" src="/js/view/samplesubmission.js"></script>-->    
<script src="/js/lib/datepicker/bootstrap-datepicker.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {

        var isValidForm = function () {
            var flagTargetDate = false,
                flagStatus = false;

            if ($(".ddlSamplesubmission").val() == "") {
                $(".errorStatus").html("please select status").show("slow");                
            } else {
                flagStatus = true;
                $(".errorStatus").html("").hide();
            }

            if ($.trim($(".datepicker").val()).length == 0) {
                $(".errorDate").html("please select target date").show("slow");

            } else {
                flagTargetDate = true;
                $(".errorDate").hide().html("");
            }
           
            return flagTargetDate && flagStatus;
        },
            imagesArray = [],
            rfqId,
            selectedStatus,
            imagesString,
            sampleStatus;

        setTimeout(function () {        

            $(".datepicker").datepicker();
            
            var myDropzone = new Dropzone('#myId', {
                url: "/samplesubmissionimages/"
            });

            myDropzone.on("success", function (file, response) {
                imagesArray.push(response.pathFromRoot);
            });

            $(".btn-Save").on('click', function () {
                if (isValidForm()) {

                    $(".hdnImages").val(imagesArray.join(",")).trigger('change');
                    rfqId = $(".hdnRfqId").val();
                    imagesString = $("#imagesString").val();
                    targetDate = $("#sampleStatusTargetDate").val();
                    selectedStatus = $("#selectedStatus").find("option:selected").text();
                    $.ajax({
                        url: '/rfq/samplesubmissions/' + rfqId,
                        method: "GET"
                    }).done(function (response) {
                        if ($.isEmptyObject(response)) {
                            $.ajax({
                                url: '/samplesubmissions/',
                                method: "POST",
                                data: { status: selectedStatus, targetDate: targetDate, imagesString: imagesString, RfqId: rfqId }
                            }).done(function (response) {
                                dfd.resolve(response);
                                $(".lblMsg").html("<span>Saved successfully !!!</span>").removeClass("hide");
                            });

                        }
                        else {
                            $.ajax({
                                url: '/rfq/samplesubmissions/' + rfqId,
                                method: "PUT",
                                data: { status: selectedStatus, targetDate: targetDate, imagesString: imagesString }
                            }).done(function (response) {
                                window.location.reload();
                            });
                        }
                        window.location.reload(true);
                    });
                }
                return false;
            });

            if ($(".elastislide").length > 0) {
                $(".elastislide").elastislide();
            }
            if ($(".elastislide1").length > 0) {
                $('.elastislide1').elastislide();
            }

            $(".ddlSamplesubmission").val($(".hdnSamplesubmissionStatus").val());

            if ($(".hdnUserId").val() != "") {
                $(".ddlUser option[selected]").remove();
                $(".ddlUser").val($(".hdnUserId").val());
            }
        }, 500);
    });

</script>