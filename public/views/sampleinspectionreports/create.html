<div class="card" ng-controller="RfqsController">
    
    <section ng-init="findOneByRfqId()" ng-show="rfq.id != null  && validatePermission">
        <h1>Sample Inspection Report</h1>
        <div ng-include="'views/rfqs/rfqBasicDetail.html'"></div>


        <div class="row">
            <div ng-include="'views/rfqs/rfqLeftNavigation.htm'" class="col col-lg-12"></div>
            <div class="col col-lg-12">
                    <div data-ng-controller="SampleInspectionReportsController" data-ng-init="findOne()" ng-show="sampleInspectionReports.length > 0" class="row">
                        <hr />
                        <div class="col col-lg-12 card">
                            <div class="row m-b-3">
                                <div class="col col-lg-2"><strong>Status</strong></div>
                                <div class="col col-lg-4"><strong>Report</strong></div>
                                <div class="col col-lg-4"><strong>Attachment</strong></div>
                                <div class="col col-lg-2"><strong>Created At</strong></div>
                            </div>
                            <div class="clear clearfix"></div>

                            <div data-ng-repeat="sampleInspectionReport in sampleInspectionReports | orderBy : '-createdAt'">
                                <div class="row m-b-3">
                                    <div class="col col-lg-2">{{sampleInspectionReport.status}}</div>
                                    <div class="col col-lg-4">{{sampleInspectionReport.report}}</div>
                                    <div class="col col-lg-4">
                                        <div class="row">
                                            <a class="m-b-3 col-lg-3 col" data-fancybox="gallery" href="{{image.imagePath}}" data-ng-repeat="image in sampleInspectionReport.SampleInspectionReportImages | orderBy : '-createdAt'">
                                                <img src="{{image.imagePath}}" alt="image{{image.id}}" class="img-responsive responsive" />
                                            </a>
                                        </div>
                                    </div>
                                    <div class="col col-lg-2">{{sampleInspectionReport.createdAt | date:'medium'}}</div>
                                </div>
                                <div class="clear clearfix"></div>
                            </div>
                        </div>
                    </div>
                  
                <h3>Add Sample Inspection Report</h3>

                    <div id="myId" class="dropzone m-t-10 m-b-10"></div>

                    <div class="control-group">
                        <label for="status" class="control-label">Status</label>
                        <div class="controls">
                            <div class="col col-lg-6">
                                <select class="form-control ddlPurchaseorder" id="selectedStatus" data-ng-model="status" required>
                                    <option value="">Select Status</option>
                                    <option ng-repeat="status in Status" value="{{status}}">{{status}}</option>
                                </select>
                                <div class="error hide error-status">Please select status</div>
                            </div>
                        </div>
                    </div>

                <div class="control-group">
                    <label for="report" class="control-label">Report</label>
                    <div class="controls">
                        <div class="col col-lg-6">
                            <textarea rows="10" class="col col-lg-12 txtReport" id="txtReport" data-ng-model="report"></textarea>
                        </div>
                    </div>
                </div>
                
                    <div class="clear clearfix"></div><br />
                    <div class="control-group">
                        <div class="controls">
                            <input type="submit" class="btn btn-primary btn-Save" value="Save">
                            <a class="btn btn-secondary" href="javascript:window.history.back();">Cancel</a>
                        </div>
                    </div>
                </div>
                <input type="hidden" class="hdnRfqId" value="{{rfq.id}}" />
                <br />

            </div>
      
    </section>

    <section ng-show="rfq.id == null && validatePermission">
        <h1>403 - Forbidden</h1>
        <p>Access Denied. You don't have access to view this page</p>
    </section>

    <section ng-show="!validatePermission">
        <h1>Loading please wait..!!</h1>
        <div class="progress">
            <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%">
            </div>
        </div>
    </section>
</div>

<script>
    $(document).ready(function () {

        var loadCode = setInterval(function () {
          
            if ($(".hdnRfqId").length > 0 && $(".hdnRfqId").val() != "") {
                var imagesArray = [];
                var rfqId;
                var selectedStatus;
                var imagesString;

                if ($(".elastislide").length > 0) {
                    $(".elastislide").elastislide();
                }

                clearInterval(loadCode);
                var myDropzone = new Dropzone('#myId', {
                    url: "/purchaseorderimages/"
                });

                myDropzone.on("success", function (file, response) {
                    imagesArray.push(response.pathFromRoot);
                });

                $(".btn-Save").on('click', function (e) {
                    if ($(".ddlPurchaseorder").val() != "") {
                        $(".error-status").hide();
                        rfqId = $(".hdnRfqId").val();
                        imagesString = imagesArray.join(",");
                        var report = $(".txtReport").val();
                        selectedStatus = $(".ddlPurchaseorder").val();
                        $.ajax({
                            url: '/sampleInspectionReports/',
                            method: "POST",
                            data: { status: selectedStatus, imagesString: imagesString, RfqId: rfqId, report: report }
                        }).done(function (response) {
                            $(".lblMsg").html("<span>Saved successfully !!!</span>").removeClass("hide");
                            window.location.reload(true);
                        });
                    } else {
                        $(".error-status").show();
                    }
                    e.stopImmediatePropagation();
                    return false;
                });
            }
        }, 500);
    });

</script>



