<h1>Add Sample Submission</h1>
<section class="card" ng-controller="SampleSubmissionsController">
    <!--<form class="form-horizontal" data-ng-submit="create()">-->
        <div class="row" data-ng-init="findOne()">
            <div class="row">
                <ul id="carousel" class="elastislide">                    
                    <li class="img_wrp" data-ng-repeat="image in samplesubmission.Samplesubmissionimages | orderBy : '-createdAt'" style="margin-right:3px;">
                        <a data-fancybox="gallery" href="{{image.imagePath}}"><img src="{{image.imagePath}}" alt="image{{image.id}}" height="150" /></a>
                        <i class="close fa fa-close deleteImage" data-id="{{image.id}}" aria-hidden="true" />
                    </li>

                </ul>
            </div>
        </div>
        <br /><br />
        <div id="myId" class="dropzone">
            <!--id="dropzone-form" -->
            <!--<div id="myId">Drop here</div>-->
        </div>

        <br /><br /><br />
        <div class="control-group">
            <label for="status" class="control-label">Status</label>
            <div class="controls">
                <div style="width:50%;">
                    <select class="form-control" id="selectedStatus" required>
                        <option value="" selected>---- Select Status ----</option>
                        <option ng-repeat="status in Status" value="{{status}}">{{status}}</option>
                    </select>
                </div>
            </div>
        </div>
    <br /><br />
        <input type="text" style="display:none;" class="hdnImages" name="imagesString" id="imagesString" data-ng-model="imagesString" />
    <br /><br />
        <div class="clear clearfix"></div><br />
        <div class="control-group">
            <div class="controls">
                <input type="submit" class="btn btn-primary btn-Save" value="Save">
                <a class="btn btn-secondary" href="javascript:window.history.back();">Cancel</a>
            </div>
        </div>
   
        <input type="hidden" ng-controller="RfqsController" ng-init="findOneByRfqId()" class="hdnRfqId" value="{{rfq.id}}" />
    <br />
    <!--</form>-->
</section>

<script type="text/javascript">
    $(document).ready(function () {
        var imagesArray = [];
        var rfqId;
        var selectedStatus;
        var imagesString;

        var myDropzone = new Dropzone('#myId', {
            url: "/samplesubmissionimages/"
        });

        myDropzone.on("success", function (file, response) {
            console.log(response);
            console.log("path from root  -->>  " + response.pathFromRoot);
            imagesArray.push(response.pathFromRoot);
        });

        $(".btn-Save").on('click', function () {
            $(".hdnImages").val(imagesArray.join(",")).trigger('change');
            rfqId = $(".hdnRfqId").val();
            imagesString = $("#imagesString").val();
            selectedStatus = $("#selectedStatus").find("option:selected").text();
            $.ajax({
                url: '/rfq/samplesubmissions/' + rfqId,
                method: "GET"
            }).done(function (response) {
                //console.log("ajax response to get sample submission by rfqId  -->  " + JSON.stringify(response) + rfqId);
                if($.isEmptyObject(response))
                {
                    console.log("response is empty");
                    $.ajax({
                        url: '/samplesubmissions/',
                        method: "POST",
                        data: { status: selectedStatus, imagesString: imagesString, RfqId: rfqId }
                    }).done(function (response) {
                        //dfd.resolve(response);
                        //$(".lblMsg").html("<span>Saved successfully !!!</span>").removeClass("hide");
                    });
                    
                }
                else
                {
                    //console.log("response is not empty  " + selectedStatus);
                    $.ajax({
                        url: '/rfq/samplesubmissions/' + rfqId,
                        method: "PUT",
                        data: { status: selectedStatus, imagesString: imagesString}
                    }).done(function (response) {
                        //window.location.reload();
                    });
                }
                window.location.reload(true);
            });
           
        });

        setTimeout(function () {
            if ($(".elastislide").length > 0) {
                $('.elastislide').elastislide();
            }


            $(".deleteImage").on('click', function () {
                var element = this;
                if (confirm("Are you sure to delete this image")) {
                    $.ajax({
                        url: '/samplesubmissionimages/' + $(this).data("id"),
                        data: { id: $(this).data("id") },
                        method: "DELETE"
                    }).done(function (response) {
                        $(".lblmsg").html("<span>deleted successfully !!!</span>");
                        // $(element).parent().remove();
                        window.location.reload(true);

                    });
                    return false;
                }
            });
        }, 500);
    });

</script>

<style>
    .img_wrp {
        display: inline-block;
        position: relative;
    }

    .close {
        position: absolute;
        top: 0;
        right: 0;
    }

    .fa-close {
        background: transparent;
        border-radius: 5%;
        height: 5em;
        width: 1em;
        color: red;
    }
</style>

